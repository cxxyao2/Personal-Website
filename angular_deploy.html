<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Angular 10</title>
    <style>
      h1,
      h2,
      footer {
        text-align: center;
      }
      .card {
        border-radius: 10px;
        width: 80%;
        min-width: 240px;
        height: 100%;
        margin: 10px auto;
        background-color: white;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.4);
        transition: 0.3s;
        overflow: hidden;
      }
      .card:hover {
        box-shadow: 0 8px 20px 0 rgba(68, 50, 183, 0.4);
      }
    </style>
  </head>
  <body>
    <h1>How to Deploy Your Angular 10 App to Heroku and Github</h1>
    <div class="card">
      <h2>Preparation</h2>
      ng build --prod
    </div>
    <div class="card">
      <h2>1, Github</h2>
      <div>
        We only need 2 steps for deploy your angular on Github. Your local
        machine, at the root folder of your project:
      </div>
      <ul>
        <li>ng add angular-cli-ghpages</li>
        <li>
          ng deploy
          --base-href=https://your-github-username.github.io/your-project-name-in-github/
        </li>
        <li>ng deploy --base-href=https://jennifer.github.io/angulardemo/</li>
      </ul>
    </div>

    <div class="card">
      <h2>2, Heroku</h2>
      <div>
        dashboard in heroku website : 1, create a new app. 2, using Github
        integration. 3, after Heroku has found our repo in git, click Connect
        button 4, click [enable automatic deploy] button
      </div>
      <div>
        We need 4 steps for deploy your angular on heroku. Your local machine,
        at the root folder of your project:
      </div>
      <ul>
        <li>npm i express --save</li>
        <li>
          write a server.js , replace ng-front with your real project name in
          package.json (name...version...)
          <pre>
            // get environment variables dynamically and create environment.ts file
            const fs = require("fs");
            const targetPath = "./src/environments/environment.ts";
            const envConfigFile = `export const environment = {
              apiBaseUrl: '${process.env.API_BASE_URL}',
              apiUrl: '${process.env.API_URL}',
              appName: '${process.env.APP_NAME}',
              awsPubKey: '${process.env.AWSKEY}',
              nodeEnv: '${process.env.NODE_ENV}',
              production: '${process.env.PRODUCTION}'
            };
            `;
            fs.writeFile(targetPath, envConfigFile, function (err) {
              if (err) {
                throw console.error(err);
              } else {
                console.log(
                  `Angular environment.ts file generated correctly at ${targetPath} \n`
                );
              }
            });

          const express = require("express");
          const app = express();
          app.use(express.static(__dirname + "/dist/ng-front")); // serve our static files

          // direct all of the requests to index.html
          app.all("/*", (req, res) => {
          res.status(200).sendFile(__dirname + "/dist/ng-front/index.html");
          });
          app.listen(process.env.PORT || 8080);
</pre
          >
        </li>
        <li>
          <ul>
            <li>node server.js</li>
            <li>verify in browser: localhost:8080</li>
            <li>
              modify package.json:
              <pre>
              "scripts": {
              "ng": "ng",
              "start": "node server.js",
              "build": "ng build --prod",
              "test": "ng test",
              "lint": "ng lint",
              "e2e": "ng e2e"
              },
              </pre>
            </li>
          </ul>
        </li>
        <li>local machine, terminal : git push heroku main</li>
        <li>Tips: folder, path,project name should be correct.</li>
      </ul>
    </div>
    <footer>
      Deployment is more easy than expected, thanking to many contributors.
    </footer>
  </body>
</html>
